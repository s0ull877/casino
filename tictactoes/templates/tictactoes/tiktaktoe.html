{% extends "users/base.html" %}

{% load i18n %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'casino/assets/tiktaktok.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
{% endblock css %}

{% block content %}
    <div class="create_game_menu">
        <div class="create_game_settings">
            <form action="{% url 'tictactoes:index' %}" method="POST">
                {% csrf_token %}
                <div class="cls" onclick="hide()">
                </div>
                <div class="content_settings">
                    <p>{% trans "Game creating" %}</p>
                </div>
                <div class="settings_player">
                    <p class="title_settings">{% trans "Select a field to play" %}</p>
                </div>
                <div class="position_radio">
                    <div class="radio_type">
                        <input type="radio" id="huey1" name="format" value="3" checked />
                        <label class="custom-radio" for="huey1">3x3</label>
                        
                        <input type="radio" id="huey2" name="format" value="5" />
                        <label class="custom-radio" for="huey2">5x5</label>
                        
                        <input type="radio" id="huey3" name="format" value="8" />
                        <label class="custom-radio" for="huey3">8x8</label>
                    </div>
                </div>
                <div class="settings_player">
                    <p class="title_settings">{% trans "Bet sum" %}</p>
                </div>
                <div class="input_sum">
                    <input type="number" name="bet" placeholder="{% trans 'Enter bet sum' %}">
                </div>
                <div class="footer_game">
                    <button type="submit">
                        <div class="create_game_auction">
                            {% trans "Create" %}
                        </div>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <!-- <header>
        <div class="header_position"> -->
            <div class="tictaktoe_status_bar">
                <a href="{% url 'users:games' %}" class="no_hook">
                    <div class="back_button">
                        <svg width="10" height="8" viewBox="0 0 10 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M-1.74847e-07 3.99998L3.79169 7.76571C3.86648 7.83999 3.95527 7.89891 4.05298 7.93911C4.1507 7.97931 4.25544 8 4.36121 8C4.46697 8 4.57171 7.97931 4.66943 7.93911C4.76714 7.89891 4.85593 7.83999 4.93072 7.76571C5.00551 7.69143 5.06484 7.60325 5.10532 7.5062C5.14579 7.40915 5.16663 7.30514 5.16663 7.20009C5.16663 7.09505 5.14579 6.99103 5.10532 6.89398C5.06484 6.79693 5.00551 6.70875 4.93072 6.63447L3.08361 4.8L9.19446 4.8C9.4081 4.8 9.61299 4.71571 9.76406 4.56568C9.91513 4.41565 10 4.21216 10 3.99997C10 3.78779 9.91513 3.5843 9.76406 3.43427C9.61299 3.28423 9.4081 3.19995 9.19446 3.19995L3.08361 3.19995L4.93072 1.36548C5.00579 1.29135 5.06536 1.20322 5.10601 1.10615C5.14665 1.00908 5.16758 0.904989 5.16758 0.799858C5.16758 0.694728 5.14665 0.590635 5.10601 0.493565C5.06536 0.396495 5.00579 0.308362 4.93072 0.234237C4.77966 0.084255 4.57481 2.76866e-07 4.3612 2.86203e-07C4.1476 2.9554e-07 3.94275 0.084255 3.79169 0.234237L-1.74847e-07 3.99998Z" fill="#707385"/>
                        </svg>            
                        <p>{% trans "Tic-Tac-Toe" %}</p>
                    </div>
                </a>
                <!-- <a href="/" class="no_hook" onclick="show()"> -->
                    <div class="create_game" onclick="show()">
                        <p>{% trans "Create game" %} + </p>
                    </div>
                <!-- </a> -->
            </div>
        <!-- </div> -->
    <!-- </header> -->
    <div class="position_class">
        <div class="background_games">
            <div class="state_auction">
                <p class="state_auction_content">{% trans "Desired rate" %}</p>
                <p class="rate">$<span id="rate">1-10</span></p>
            </div>
            <div class="rate_status">
                <div class="rate_block active_block" value="1-10"></div>
                <div class="rate_block" value="10-50"></div>
                <div class="rate_block" value="50-100"></div>
                <div class="rate_block" value="100-500"></div>
            </div>
            <div class="auction">
                <div class="auction_title">
                    <p>{% trans "Custom room" %}</p>
                </div>
            </div>
            <div id='auctions-list' class="auction_list">

            </div>
        </div>
    </div>
    <footer>
    </footer>
    <div class="bottom_bar_position">
        <div class="bottom_bar">
            <div class="center_items">
                <div class="menu_items">
                    <a href="{% url 'users:games' %}" class="games keyboard">
                        <svg width="22" height="16" viewBox="0 0 22 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g filter="url(#filter0_i_0_115)">
                            <path d="M8 0.5C3.85775 0.5 0.5 3.85775 0.5 8C0.5 12.1423 3.85775 15.5 8 15.5H14C18.1423 15.5 21.5 12.1423 21.5 8C21.5 3.85775 18.1423 0.5 14 0.5H8ZM15.5 10.25C15.5 10.6478 15.342 11.0294 15.0607 11.3107C14.7794 11.592 14.3978 11.75 14 11.75C13.6022 11.75 13.2206 11.592 12.9393 11.3107C12.658 11.0294 12.5 10.6478 12.5 10.25C12.5 9.85218 12.658 9.47064 12.9393 9.18934C13.2206 8.90804 13.6022 8.75 14 8.75C14.3978 8.75 14.7794 8.90804 15.0607 9.18934C15.342 9.47064 15.5 9.85218 15.5 10.25ZM15.5 7.25C15.1022 7.25 14.7206 7.09196 14.4393 6.81066C14.158 6.52936 14 6.14782 14 5.75C14 5.35218 14.158 4.97064 14.4393 4.68934C14.7206 4.40804 15.1022 4.25 15.5 4.25C15.8978 4.25 16.2794 4.40804 16.5607 4.68934C16.842 4.97064 17 5.35218 17 5.75C17 6.14782 16.842 6.52936 16.5607 6.81066C16.2794 7.09196 15.8978 7.25 15.5 7.25ZM6.5 5C6.69891 5 6.88968 5.07902 7.03033 5.21967C7.17098 5.36032 7.25 5.55109 7.25 5.75V7.25H8.75C8.94891 7.25 9.13968 7.32902 9.28033 7.46967C9.42098 7.61032 9.5 7.80109 9.5 8C9.5 8.19891 9.42098 8.38968 9.28033 8.53033C9.13968 8.67098 8.94891 8.75 8.75 8.75H7.25V10.25C7.25 10.4489 7.17098 10.6397 7.03033 10.7803C6.88968 10.921 6.69891 11 6.5 11C6.30109 11 6.11032 10.921 5.96967 10.7803C5.82902 10.6397 5.75 10.4489 5.75 10.25V8.75H4.25C4.05109 8.75 3.86032 8.67098 3.71967 8.53033C3.57902 8.38968 3.5 8.19891 3.5 8C3.5 7.80109 3.57902 7.61032 3.71967 7.46967C3.86032 7.32902 4.05109 7.25 4.25 7.25H5.75V5.75C5.75 5.55109 5.82902 5.36032 5.96967 5.21967C6.11032 5.07902 6.30109 5 6.5 5Z" fill="url(#paint0_linear_0_115)"/>
                            </g>
                            <defs>
                            <filter id="filter0_i_0_115" x="0.5" y="-0.5" width="21" height="16" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
                            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                            <feOffset dy="-1"/>
                            <feGaussianBlur stdDeviation="0.85"/>
                            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/>
                            <feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.69 0"/>
                            <feBlend mode="overlay" in2="shape" result="effect1_innerShadow_0_115"/>
                            </filter>
                            <linearGradient id="paint0_linear_0_115" x1="10.5197" y1="6.02435" x2="11" y2="22" gradientUnits="userSpaceOnUse">
                            <stop stop-color="white"/>
                            <stop offset="1" stop-color="#1271FF"/>
                            </linearGradient>
                            </defs>
                        </svg>
                    </a>
                    <a href="{% url 'users:profile' %}">
                        <div class="profile keyboard">
                            <svg width="20" height="21" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19.1555 19.9811C19.816 19.8325 20.2108 19.086 19.8818 18.4479C19.1567 17.044 18.0153 15.8092 16.5555 14.8689C14.6747 13.6574 12.369 13 10 13C7.63096 13 5.32533 13.6561 3.44446 14.8689C1.98475 15.8092 0.843301 17.044 0.118231 18.4479C-0.210802 19.086 0.184038 19.8325 0.844498 19.9811C6.88289 21.3396 13.1159 21.3396 19.1543 19.9811" fill="#3D404F"/>
                                <path d="M10 12C13.3137 12 16 9.31371 16 6C16 2.68629 13.3137 0 10 0C6.68629 0 4 2.68629 4 6C4 9.31371 6.68629 12 10 12Z" fill="#3D404F"/>
                            </svg>                       
                        </div>
                    </a>
                    <a href="{% url 'users:settings' %}">
                        <div class="settings keyboard">
                            <svg width="19" height="20" viewBox="0 0 19 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.2791 0.152C10.9091 -4.47035e-08 10.4391 0 9.50007 0C8.56107 0 8.09207 -4.47035e-08 7.72107 0.152C7.47696 0.251745 7.25498 0.398782 7.06792 0.584647C6.88085 0.770512 6.73239 0.991536 6.63107 1.235C6.53707 1.458 6.50107 1.719 6.48607 2.098C6.47893 2.3725 6.40214 2.64068 6.2629 2.87736C6.12366 3.11403 5.92654 3.31142 5.69007 3.451C5.44882 3.5851 5.17762 3.65615 4.9016 3.65754C4.62558 3.65894 4.35367 3.59065 4.11107 3.459C3.77307 3.281 3.52807 3.183 3.28607 3.151C2.75665 3.08192 2.22134 3.2242 1.79607 3.547C1.47807 3.789 1.24307 4.193 0.774071 5C0.304071 5.807 0.0700714 6.21 0.0170714 6.605C-0.0529286 7.131 0.0910715 7.663 0.417071 8.084C0.565071 8.276 0.774072 8.437 1.09707 8.639C1.57407 8.936 1.88007 9.442 1.88007 10C1.88007 10.558 1.57407 11.064 1.09807 11.36C0.774071 11.563 0.565071 11.724 0.416071 11.916C0.255638 12.1242 0.137821 12.362 0.0693571 12.6158C0.000893369 12.8696 -0.0168739 13.1343 0.0170714 13.395C0.0700714 13.789 0.304071 14.193 0.774071 15C1.24407 15.807 1.47807 16.21 1.79607 16.453C2.22007 16.776 2.75607 16.918 3.28607 16.849C3.52807 16.817 3.77307 16.719 4.11107 16.541C4.3538 16.4092 4.62589 16.3408 4.9021 16.3422C5.17831 16.3436 5.44969 16.4147 5.69107 16.549C6.17707 16.829 6.46507 17.344 6.48607 17.902C6.50107 18.282 6.53707 18.542 6.63107 18.765C6.83507 19.255 7.22707 19.645 7.72107 19.848C8.09107 20 8.56107 20 9.50007 20C10.4391 20 10.9091 20 11.2791 19.848C11.5232 19.7483 11.7452 19.6012 11.9322 19.4154C12.1193 19.2295 12.2678 19.0085 12.3691 18.765C12.4631 18.542 12.4991 18.282 12.5141 17.902C12.5341 17.344 12.8231 16.828 13.3101 16.549C13.5513 16.4149 13.8225 16.3439 14.0985 16.3425C14.3746 16.3411 14.6465 16.4093 14.8891 16.541C15.2271 16.719 15.4721 16.817 15.7141 16.849C16.2441 16.919 16.7801 16.776 17.2041 16.453C17.5221 16.211 17.7571 15.807 18.2261 15C18.6961 14.193 18.9301 13.79 18.9831 13.395C19.0169 13.1343 18.9989 12.8695 18.9303 12.6157C18.8617 12.3619 18.7437 12.1241 18.5831 11.916C18.4351 11.724 18.2261 11.563 17.9031 11.361C17.4261 11.064 17.1201 10.558 17.1201 10C17.1201 9.442 17.4261 8.936 17.9021 8.64C18.2261 8.437 18.4351 8.276 18.5841 8.084C18.7445 7.87579 18.8623 7.63799 18.9308 7.38422C18.9992 7.13044 19.017 6.86565 18.9831 6.605C18.9301 6.211 18.6961 5.807 18.2261 5C17.7561 4.193 17.5221 3.79 17.2041 3.547C16.7788 3.2242 16.2435 3.08192 15.7141 3.151C15.4721 3.183 15.2271 3.281 14.8891 3.459C14.6463 3.59083 14.3743 3.65922 14.098 3.65782C13.8218 3.65642 13.5504 3.58528 13.3091 3.451C13.0728 3.3113 12.8759 3.11385 12.7368 2.87719C12.5977 2.64052 12.5211 2.37241 12.5141 2.098C12.4991 1.718 12.4631 1.458 12.3691 1.235C12.2678 0.991536 12.1193 0.770512 11.9322 0.584647C11.7452 0.398782 11.5232 0.251745 11.2791 0.152ZM9.50007 13C11.1701 13 12.5231 11.657 12.5231 10C12.5231 8.343 11.1691 7 9.50007 7C7.83107 7 6.47707 8.343 6.47707 10C6.47707 11.657 7.83107 13 9.50007 13Z" fill="#3D404F"/>
                            </svg>                 
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <script>

        if (window.location.protocol == 'https:') {
            const ws = new WebSocket('wss://' + window.location.host + '/ws/games/');
        } else {
            const ws = new WebSocket('ws://' + window.location.host + '/ws/games/');
        }

        ws.onmessage = function(event) {
            let data = JSON.parse(event.data);
            document.getElementById('auctions-list').innerHTML = data.html;
        }
    
        let intervalId;
    
        ws.onopen = function() {
            intervalId = setInterval(function() {
                ws.send(''); 
            }, 1000);
        };
    
        ws.onclose = function() {
            clearInterval(intervalId);
            window.location.replace(document.URL);
        };

        const rate_blocks = document.querySelectorAll('.rate_block');
        const rate = document.getElementById('rate');
        
        rate_blocks.forEach(rate_block => {
            rate_block.addEventListener('click', function() {
                document.querySelector('.active_block').classList.remove('active_block')
                this.classList.add('active_block')
                rate.innerHTML = this.getAttribute('value');
                ws.send(this.getAttribute('value'));
            });
        });

        function show() {
            const createGameMenu = document.querySelector('.create_game_menu');
            
            if (createGameMenu) {
                createGameMenu.classList.toggle('show');
            } else {
                console.error('Не удалось найти элемент .create_game_menu.');
            }
        }

        function hide() {
            const createGameMenu = document.querySelector('.create_game_menu');
            
            if (createGameMenu) {
                createGameMenu.classList.remove('show'); // Убираем класс show
            } else {
                console.error('Не удалось найти элемент .create_game_menu.');
            }
        }

    </script>
{% endblock content %}